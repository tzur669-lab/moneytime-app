<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>מתחבר...</title>
<style>
body{font-family:sans-serif;display:flex;align-items:center;justify-content:center;height:100vh;margin:0;background:#1E3A8A;color:white;text-align:center;flex-direction:column;gap:16px}
.spinner{width:40px;height:40px;border:4px solid rgba(255,255,255,.3);border-top-color:white;border-radius:50%;animation:spin 1s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}
p{font-size:16px;opacity:.8}
</style>
</head>
<body>
<div class="spinner"></div>
<p>מחבר את חשבון Google...</p>
<script>
var hash = window.location.hash || window.location.search;
var params = new URLSearchParams(hash.replace(/^[#?]/,''));
var token = params.get('access_token');

if(token){
  document.querySelector('p').textContent = 'מחובר! חוזר לאפליקציה...';

  // שמור ב-localStorage כ-fallback
  try{
    localStorage.setItem('gtoken', token);
    localStorage.setItem('syen', '1');
    localStorage.setItem('oauth_done', Date.now().toString());
  }catch(e){}

  // פנה ל-deep link — אנדרואיד יפתח את האפליקציה
  // ה-App plugin יאזין ל-appUrlOpen עם ה-token
  var deepLink = 'com.tzur669.moneytime://oauth#access_token=' + encodeURIComponent(token);

  setTimeout(function(){
    window.location.href = deepLink;
  }, 300);

  // fallback — אם deep link לא עובד, redirect לדף הראשי
  setTimeout(function(){
    window.location.href = 'index.html';
  }, 2500);

} else {
  document.querySelector('p').textContent = 'שגיאה בהתחברות. חוזר...';
  setTimeout(function(){
    window.location.href = 'index.html';
  }, 2000);
}
</script>
</body>
</html>
